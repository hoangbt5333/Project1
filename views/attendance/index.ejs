<div class="space-y-6">
  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
      <div>
        <p class="text-xs uppercase tracking-[0.3em] text-slate-400 font-semibold">Điểm danh</p>
        <h2 class="text-2xl font-bold text-slate-800">Tạo buổi & QR chỉ trong vài giây</h2>
        <p class="text-slate-500">Chọn lớp, môn, thời gian kết thúc và hệ thống sinh QR cho sinh viên quét.</p>
      </div>
      <div class="text-slate-500 text-sm flex items-center gap-2">
        <i class="fa-solid fa-shield-check text-emerald-500"></i> QR hết hạn theo thời gian bạn đặt.
      </div>
    </div>
    <% if (message) { %>
      <div class="rounded-xl bg-blue-50 text-blue-800 px-4 py-3 mb-4 flex items-center gap-2">
        <i class="fa-solid fa-circle-info"></i> <span><%= message %></span>
      </div>
    <% } %>
    <form action="/attendance/create" method="POST" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="lg:col-span-2">
        <label class="block text-sm font-semibold text-slate-700 mb-1">Tên buổi/ghi chú</label>
        <input type="text" name="title" placeholder="VD: Lập trình WEB - Tuần 5" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand focus:border-brand bg-slate-50">
      </div>
      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">Lớp học</label>
        <select name="ma_lop" class="w-full px-4 py-3 border border-slate-200 rounded-xl bg-white focus:ring-2 focus:ring-brand focus:border-brand">
          <option value="">Tất cả lớp</option>
          <% classes.forEach((lop) => { %>
            <option value="<%= lop.ma_lop %>"><%= lop.ten_lop %></option>
          <% }) %>
        </select>
      </div>
      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">Môn học</label>
        <select name="ma_mon_hoc" class="w-full px-4 py-3 border border-slate-200 rounded-xl bg-white focus:ring-2 focus:ring-brand focus:border-brand">
          <option value="">Không chọn</option>
          <% subjects.forEach((mh) => { %>
            <option value="<%= mh.ma_mon_hoc %>"><%= mh.ten_mon_hoc %></option>
          <% }) %>
        </select>
      </div>
      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">Kết thúc lúc</label>
        <input type="datetime-local" name="expired_at" value="<%= new Date(Date.now() + 45 * 60000).toISOString().slice(0,16) %>" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand focus:border-brand bg-slate-50">
      </div>
      <div class="lg:col-span-4 flex justify-end">
        <button class="inline-flex items-center gap-2 px-5 py-3 bg-brand text-white rounded-xl font-semibold hover:bg-brand-soft transition">
          <i class="fa-solid fa-rocket-launch"></i> Tạo QR
        </button>
      </div>
    </form>
  </div>

  <div class="flex items-center justify-between flex-wrap gap-2">
    <h4 class="text-xl font-semibold text-slate-800">Phiên điểm danh gần đây</h4>
    <span class="text-sm text-slate-500">Sắp xếp mới nhất</span>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
    <% if (sessions.length === 0) { %>
      <div class="col-span-full text-center bg-white border border-dashed border-slate-200 rounded-2xl p-8 text-slate-500">
        <i class="fa-regular fa-calendar-minus text-2xl mb-2"></i>
        <p class="font-semibold text-slate-700">Chưa có buổi nào</p>
        <p class="text-sm">Tạo buổi điểm danh đầu tiên để sinh viên quét QR và xác nhận.</p>
      </div>
    <% } %>

    <% sessions.forEach((session) => { %>
      <% 
        const expired = session.isExpired;
        const status = session.status === 'closed' ? 'Đã khóa' : (expired ? 'Hết hạn' : 'Đang mở');
        const badgeClass = session.status === 'closed' ? 'bg-slate-200 text-slate-700' : (expired ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700');
      %>
      <div class="bg-white border border-slate-100 rounded-2xl p-5 shadow-sm flex flex-col gap-3">
        <div class="flex items-start justify-between">
          <div>
            <p class="text-xs text-slate-500"><%= new Date(session.created_at).toLocaleString('vi-VN') %></p>
            <h5 class="text-lg font-semibold text-slate-800"><%= session.title %></h5>
          </div>
          <span class="px-3 py-1 rounded-full text-xs font-semibold <%= badgeClass %>"><%= status %></span>
        </div>
        <div class="space-y-1 text-sm text-slate-600">
          <p><i class="fa-solid fa-layer-group text-brand mr-2"></i><strong>Lớp:</strong> <%= session.ten_lop || 'Tất cả' %></p>
          <p><i class="fa-solid fa-book text-brand mr-2"></i><strong>Môn:</strong> <%= session.ten_mon_hoc || 'Chưa chọn' %></p>
          <p><i class="fa-solid fa-hourglass-half text-brand mr-2"></i><strong>Kết thúc:</strong> <%= session.expired_at ? new Date(session.expired_at).toLocaleString('vi-VN') : 'Không giới hạn' %></p>
        </div>
        <div class="flex items-center justify-between">
          <div>
            <p class="text-2xl font-bold text-slate-800"><%= session.presentCount %></p>
            <p class="text-xs text-slate-500">Sinh viên đã điểm danh</p>
          </div>
          <div class="text-right">
            <button type="button" class="inline-flex items-center gap-2 px-3 py-2 border border-slate-200 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-50 transition mb-2" data-copy="<%= session.shareUrl %>">
              <i class="fa-regular fa-copy"></i> Sao chép link
            </button>
            <div>
              <a href="/attendance/session/<%= session.id %>" class="text-brand text-sm font-semibold hover:underline">Xem chi tiết</a>
            </div>
          </div>
        </div>
        <% if (session.qr) { %>
          <div class="flex justify-end">
            <img src="<%= session.qr %>" alt="QR" class="w-24 h-24 object-contain bg-slate-50 p-2 rounded-xl border border-slate-100">
          </div>
        <% } %>
      </div>
    <% }) %>
  </div>
</div>
