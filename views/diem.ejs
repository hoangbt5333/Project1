<div class="space-y-6">
  <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
    <div>
      <p class="text-xs uppercase tracking-[0.3em] text-slate-400 font-semibold">Điểm</p>
      <h2 class="text-2xl font-bold text-slate-800">Danh sách điểm</h2>
    </div>

    <div class="flex flex-wrap items-center gap-3">
      <a href="/diem/add"
         class="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white font-semibold rounded-xl hover:bg-brand-soft transition">
        <i class="fa-solid fa-plus"></i> Nhập điểm
      </a>

      <!-- Nhóm Import/Export compact -->
      <div class="flex items-center gap-2 bg-white border border-slate-200 rounded-full px-3 py-1 shadow-sm">
        <form action="/diem/import" method="POST" enctype="multipart/form-data" class="m-0 p-0">
          <input id="diemExcelInput" name="excelFile" type="file" accept=".xlsx,.xls" class="hidden" onchange="this.form.submit()" />
          <label for="diemExcelInput"
                 class="inline-flex items-center gap-2 px-3 py-2 text-sm font-semibold text-emerald-700 bg-emerald-50 rounded-lg hover:bg-emerald-100 cursor-pointer transition">
            <i class="fa-solid fa-file-import"></i> Nhập
          </label>
        </form>

        <form action="/diem/export" method="GET" class="m-0 p-0">
          <button type="submit"
                  class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-200 text-sm font-semibold text-slate-700 hover:bg-slate-50 transition">
            <i class="fa-solid fa-file-export"></i> Xuất Excel
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast (fixed, không đẩy layout) -->
  <% if (typeof message !== 'undefined' && message) { %>
    <div id="toast-message"
         class="fixed top-6 right-6 z-50 max-w-xs px-4 py-3 rounded-lg shadow-lg text-sm bg-emerald-600 text-white flex items-center gap-3"
         role="status" aria-live="polite">
      <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293A1 1 0 006.293 10.707l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
      <div class="flex-1 truncate"><%= message %></div>
      <button id="toast-close" class="text-white opacity-90 hover:opacity-100 focus:outline-none">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <script>
      (function(){
        const toast = document.getElementById('toast-message');
        const closeBtn = document.getElementById('toast-close');
        if (!toast) return;
        // auto close sau 3s
        setTimeout(() => {
          toast.style.transition = 'opacity 300ms ease, transform 300ms ease';
          toast.style.opacity = '0';
          toast.style.transform = 'translateY(-8px)';
          setTimeout(() => toast.remove(), 350);
        }, 3000);
        closeBtn && closeBtn.addEventListener('click', () => toast.remove());
      })();
    </script>
  <% } %>

  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-5 space-y-4">
    <form class="grid grid-cols-1 md:grid-cols-3 gap-3" method="get" action="/diem">
      <input type="text" name="search" value="<%= search || '' %>" placeholder="Tìm sinh viên, mã SV..."
             class="w-full px-4 py-3 border border-slate-200 rounded-xl bg-slate-50 focus:ring-2 focus:ring-brand focus:border-brand">
      <select name="monhoc"
              class="w-full px-4 py-3 border border-slate-200 rounded-xl bg-white focus:ring-2 focus:ring-brand focus:border-brand">
        <option value="">Tất cả môn học</option>
        <% (monhocList || []).forEach(m => { %>
          <option value="<%= m.ten_mon_hoc %>" <%= monhoc === m.ten_mon_hoc ? 'selected' : '' %>><%= m.ten_mon_hoc %></option>
        <% }) %>
      </select>
      <div class="flex items-center gap-3">
        <button class="px-4 py-3 bg-brand text-white font-semibold rounded-xl hover:bg-brand-soft transition">Lọc</button>
        <a href="/diem" class="px-4 py-3 border border-slate-200 rounded-xl text-sm text-slate-700 hover:bg-slate-50 transition">Đặt lại</a>
      </div>
    </form>

    <div class="overflow-x-auto table-scroll">
      <table class="min-w-full text-left text-sm text-slate-700">
        <thead class="table-head sticky top-0 z-20">
          <tr class="bg-slate-50 text-xs uppercase text-slate-500 border-b border-slate-200">
            <th class="px-4 py-3">Mã SV</th>
            <th class="px-4 py-3">Họ tên</th>
            <th class="px-4 py-3">Học kỳ</th>
            <th class="px-4 py-3">Môn học</th>
            <th class="px-4 py-3">Điểm chữ</th>
            <th class="px-4 py-3">Điểm số</th>
          </tr>
        </thead>

        <tbody>
          <% if (scores && scores.length > 0) { %>
            <% scores.forEach((item, idx) => { %>
              <tr class="odd:bg-white even:bg-slate-100 hover:bg-gray-100 transition">
                <td class="px-4 py-3 font-semibold text-slate-800"><%= item.ma_sv %></td>
                <td class="px-4 py-3"><%= item.ho_ten %></td>
                <td class="px-4 py-3"><%= item.hoc_ky %></td>
                <td class="px-4 py-3"><%= item.ten_mon_hoc %></td>
                <td class="px-4 py-3"><%= item.diem_chu %></td>
                <td class="px-4 py-3"><%= item.diem_so %></td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="6" class="px-4 py-6 text-center text-slate-500">Không có dữ liệu phù hợp</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
